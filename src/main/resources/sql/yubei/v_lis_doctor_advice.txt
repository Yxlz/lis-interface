CREATE OR REPLACE VIEW V_LIS_DOCTOR_ADVICE
(PATIENT_ID,SAMPLE_IS_REFUSE,ORDER_NO,INSPEC_ITEM_CODE,INSPEC_ITEM_NAME,ORDER_TIME_STARTING,ORDER_TIME_LIMIT,ORDER_FREQUENCY_CODE,ORDER_FREQUENCY_NAME,PRIORITY,EXCUTE_SECTION_CODE,EXCUTE_SECTION_NAME,
BARCODE,SAMPLE_CODE,SAMPLE_NAME,TIME_COLLECT,COLLECTOR_CODE,COLLECTOR_NAME,COLLECTOR_PLACE,ATTENTION_CODE,ATTENTION_NAME)
AS
SELECT ITEM.PATIENT_ID                  AS PATIENT_ID,
       '0'                              AS SAMPLE_IS_REFUSE,
       ITEM.ORDER_ID                    AS ORDER_NO,
       ITEM.REQ_ITEM_NO                 AS INSPEC_ITEM_CODE,
       ITEM.REQ_ITEM_NAME               AS INSPEC_ITEM_NAME,
       EPI.EFFECTIVE_LOW                AS ORDER_TIME_STARTING,
       EPI.EFFECTIVE_HIGH               AS ORDER_TIME_LIMIT,
       EPI.MEDICAL_ORDER_FREQUENCY_CODE AS ORDER_FREQUENCY_CODE,
       EPI.MEDICAL_ORDER_FREQUENCY      AS ORDER_FREQUENCY_NAME,
       EPI.PRIORITYCODE                 AS PRIORITY,
       ITEM.EXECUTE_SECTION_ID          AS EXCUTE_SECTION_CODE,
       ITEM.EXECUTE_SECTION             AS EXCUTE_SECTION_NAME,
       NULL                             AS BARCODE,
       NULL                             AS SAMPLE_CODE,
       NULL                             AS SAMPLE_NAME,
       NULL                             AS TIME_COLLECT,
       NULL                             AS COLLECTOR_CODE,
       NULL                             AS COLLECTOR_NAME,
       NULL                             AS COLLECTOR_PLACE,
       NULL                             AS ATTENTION_CODE,
       NULL                             AS ATTENTION_NAME
  FROM LIS_EXCHANGE_PATIENT_INFO EPI
  LEFT JOIN LIS_EXCHANGE_PATIENT_ITEMS ITEM
    ON ITEM.PATIENT_ID = EPI.ID
 RIGHT JOIN LIS_REQUESTION_RECEIVE_TROUBLE RR
    ON EPI.PATIENT_ID = RR.BARCODE
 WHERE EPI.PERSON_INFO_ID IS NOT NULL
UNION ALL
SELECT ITEM.PATIENT_ID AS PATIENT_ID,
       '1' AS SAMPLE_IS_REFUSE,
       ITEM.ORDER_ID AS ORDER_NO,
       ITEM.REQ_ITEM_NO AS INSPEC_ITEM_CODE,
       ITEM.REQ_ITEM_NAME AS INSPEC_ITEM_NAME,
       EPI.EFFECTIVE_LOW AS ORDER_TIME_STARTING,
       EPI.EFFECTIVE_HIGH AS ORDER_TIME_LIMIT,
       EPI.MEDICAL_ORDER_FREQUENCY_CODE AS ORDER_FREQUENCY_CODE,
       EPI.MEDICAL_ORDER_FREQUENCY AS ORDER_FREQUENCY_NAME,
       EPI.PRIORITYCODE AS PRIORITY,
       ITEM.EXECUTE_SECTION_ID AS EXCUTE_SECTION_CODE,
       ITEM.EXECUTE_SECTION AS EXCUTE_SECTION_NAME,
       RR.BARCODE AS BARCODE,
       EPI.SAMPLE_CODE AS SAMPLE_CODE,
       EPI.SAMPLE_NAME AS SAMPLE_NAME,
       RR.TIME_RECEIVE AS TIME_COLLECT,
       RR.DOC_COLLECT_JOBNUMBER AS COLLECTOR_CODE,
       RR.DOC_COLLECT AS COLLECTOR_NAME,
       DECODE(RR.P_TYPE, 0, '检验科', 1, '护士站', '体检中心') AS COLLECTOR_PLACE,
       EPI.SAMPLE_CODE AS ATTENTION_CODE,
       EPI.SAMPLE_NAME AS ATTENTION_NAME
  FROM LIS_EXCHANGE_PATIENT_INFO EPI
  LEFT JOIN LIS_EXCHANGE_PATIENT_ITEMS ITEM
    ON ITEM.PATIENT_ID = EPI.ID
 RIGHT JOIN LIS_REQUESTION_RECEIVE RR
    ON EPI.PATIENT_ID = RR.BARCODE
 WHERE EPI.PERSON_INFO_ID IS NOT NULL