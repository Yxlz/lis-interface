CREATE OR REPLACE VIEW V_LIS_INSPEC_STATE
(REQ_NO,REQ_DESCRIPTION,BARCODE,SAMPLE_CODE,SAMPLE_NAME,OPERATION_TIME,SAMPLE_STATE_CODE,SAMPLE_STATE_STR,SAMPLE_REFUSE_REASON,OPERATOR_JOB_NUMBER,OPERATOR_NAME,OPERATOR_DEPT_CODE,
 OPERATOR_DEPT_NAME,PERSON_INFO_ID,ID_NUMBER,HEALTH_CARE_CARD_NO,PATIENT_NAME,PATIENT_SEX_CODE,PATIENT_SEX_STR,PATIENT_BIRTHDAY)
AS
SELECT EPI.REQUEST_NO AS REQ_NO,
       EPI.REQUEST_TEXT AS REQ_DESCRIPTION,
       RR.BARCODE AS BARCODE,
       EPI.SAMPLE_CODE AS SAMPLE_CODE,
       EPI.SAMPLE_NAME AS SAMPLE_NAME,
       RR.TIME_RECEIVE AS OPERATION_TIME,
       RR.REFUSE AS SAMPLE_STATE_CODE,
       DECODE(RR.REFUSE,
              4,
              '标本接收',
              8,
              '标本上机',
              16,
              '标本审核',
              32,
              '报告打印',
              64,
              '危急值',
              128,
              '标本提交',
              256,
              '传染病',
              '') AS SAMPLE_STATE_STR,
       RR.REFUSE_REASON AS SAMPLE_REFUSE_REASON,
       RR.DOC_RECEIVE_JOBNUMBER AS OPERATOR_JOB_NUMBER,
       RR.DOC_RECEIVE AS OPERATOR_NAME,
       RR.RECEIVE_DEPT_CODE AS OPERATOR_DEPT_CODE,
       RR.RECEIVE_SECTION AS OPERATOR_DEPT_NAME,
       EPI.PERSON_INFO_ID AS PERSON_INFO_ID,
       EPI.ID_CARD_NUM AS ID_NUMBER,
       EPI.HEALTH_CARD_NUMBER AS HEALTH_CARE_CARD_NO,
       EPI.PATIENT_NAME AS PATIENT_NAME,
       EPI.PATIENT_SEX AS PATIENT_SEX_CODE,
       RR.P_SEX AS PATIENT_SEX_STR,
       EPI.BIRDTHDAY AS PATIENT_BIRTHDAY
  FROM LIS_EXCHANGE_PATIENT_INFO EPI
 RIGHT JOIN LIS_REQUESTION_RECEIVE RR
    ON EPI.PATIENT_ID = RR.BARCODE
 WHERE EPI.PERSON_INFO_ID IS NOT NULL
UNION ALL
SELECT EPI.REQUEST_NO AS REQ_NO,
       EPI.REQUEST_TEXT AS REQ_DESCRIPTION,
       RR.BARCODE AS BARCODE,
       EPI.SAMPLE_CODE AS SAMPLE_CODE,
       EPI.SAMPLE_NAME AS SAMPLE_NAME,
       RR.TIME_RECEIVE AS OPERATION_TIME,
       '1' AS SAMPLE_STATE_CODE,
       '标本拒收' AS SAMPLE_STATE_STR,
       RR.REFUSE_REASON AS SAMPLE_REFUSE_REASON,
       NULL AS OPERATOR_JOB_NUMBER,
       RR.REPORTER AS OPERATOR_NAME,
       RR.RECEIVE_DEPT_CODE AS OPERATOR_DEPT_CODE,
       RR.RECEIVE_SECTION AS OPERATOR_DEPT_NAME,
       EPI.PERSON_INFO_ID AS PERSON_INFO_ID,
       EPI.ID_CARD_NUM AS ID_NUMBER,
       EPI.HEALTH_CARD_NUMBER AS HEALTH_CARE_CARD_NO,
       EPI.PATIENT_NAME AS PATIENT_NAME,
       EPI.PATIENT_SEX AS PATIENT_SEX_CODE,
       RR.P_SEX AS PATIENT_SEX_STR,
       EPI.BIRDTHDAY AS PATIENT_BIRTHDAY
  FROM LIS_EXCHANGE_PATIENT_INFO EPI
 RIGHT JOIN LIS_REQUESTION_RECEIVE_TROUBLE RR
    ON EPI.PATIENT_ID = RR.BARCODE
 WHERE EPI.PERSON_INFO_ID IS NOT NULL