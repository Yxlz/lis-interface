CREATE OR REPLACE VIEW V_LIS_SAMPLE_INFO
(PATIENT_ID,SAMPLE_IS_REFUSE,REGION_ID,PATIENT_CODE,PATIENT_TYPE,PATIENT_CODE1,ORDER_TIME,ORDER_DOCTOR_CODE,ORDER_DOCTOR_NAME,ORDER_DEPT_CODE,ORDER_DEPT_NAME,TIME_RECEIVE_STARTING,TIME_RECEIVE_LIMIT,
RECEIVER_JOB_NO,RECEIVER_NAME,CONFIRM_TIME,THE_CONFIRM_CODE,THE_CONFIRM_NAME,REQUEST_NO,INSPEC_NAME_CODE,INSPEC_NAME,REQ_DATE)
AS
SELECT EPI.ID AS PATIENT_ID,
       '1' AS SAMPLE_IS_REFUSE,
       DECODE(RR.P_TYPE, 0, '01', 1, '02', 2, '03', '') AS REGION_ID,
       RR.BARCODE AS PATIENT_CODE,
       DECODE(RR.P_TYPE, 0, '01', 1, '04', 2, '05', 3, '02', '') AS PATIENT_TYPE,
       RR.BARCODE AS PATIENT_CODE1,
       EPI.REQ_DATE AS ORDER_TIME,
       EPI.DOCTOR_NAME_ID AS ORDER_DOCTOR_CODE,
       EPI.DOCTOR_NAME AS ORDER_DOCTOR_NAME,
       EPI.SECTION_NAME_ID AS ORDER_DEPT_CODE,
       EPI.SECTION_NAME AS ORDER_DEPT_NAME,
       RR.TIME_RECEIVE AS TIME_RECEIVE_STARTING,
       RR.TIME_RECEIVE AS TIME_RECEIVE_LIMIT,
       RR.DOC_RECEIVE_JOBNUMBER AS RECEIVER_JOB_NO,
       RR.DOC_RECEIVE AS RECEIVER_NAME,
       RR.TIME_RECEIVE AS CONFIRM_TIME,
       RR.DOC_RECEIVE_JOBNUMBER AS THE_CONFIRM_CODE,
       RR.DOC_RECEIVE AS THE_CONFIRM_NAME,
       EPI.REQUEST_NO AS REQUEST_NO,
       EPI.INSPEC_NAME_CODE AS INSPEC_NAME_CODE,
       EPI.INSPEC_NAME AS INSPEC_NAME,
       EPI.REQ_DATE AS REQ_DATE
  FROM LIS_EXCHANGE_PATIENT_INFO EPI
 RIGHT JOIN LIS_REQUESTION_RECEIVE RR
    ON EPI.PATIENT_ID = RR.BARCODE
 WHERE EPI.PERSON_INFO_ID IS NOT NULL
UNION ALL
SELECT EPI.ID AS PATIENT_ID,
       '0' AS SAMPLE_IS_REFUSE,
       DECODE(RR.P_TYPE, 0, '01', 1, '02', 2, '03', '') AS REGION_ID,
       RR.BARCODE AS PATIENT_CODE,
       DECODE(RR.P_TYPE, 0, '01', 1, '04', 2, '05', 3, '02', '') AS PATIENT_TYPE,
       RR.BARCODE AS PATIENT_CODE1,
       EPI.REQ_DATE AS ORDER_TIME,
       EPI.DOCTOR_NAME_ID AS ORDER_DOCTOR_CODE,
       EPI.DOCTOR_NAME AS ORDER_DOCTOR_NAME,
       EPI.SECTION_NAME_ID AS ORDER_DEPT_CODE,
       EPI.SECTION_NAME AS ORDER_DEPT_NAME,
       NULL AS TIME_RECEIVE_STARTING,
       NULL AS TIME_RECEIVE_LIMIT,
       NULL AS RECEIVER_JOB_NO,
       NULL AS RECEIVER_NAME,
       RR.TIME_RECEIVE AS CONFIRM_TIME,
       RR.REPORTER AS THE_CONFIRM_CODE,
       RR.REPORTER AS THE_CONFIRM_NAME,
       EPI.REQUEST_NO AS REQUEST_NO,
       EPI.INSPEC_NAME_CODE AS INSPEC_NAME_CODE,
       EPI.INSPEC_NAME AS INSPEC_NAME,
       EPI.REQ_DATE AS REQ_DATE
  FROM LIS_EXCHANGE_PATIENT_INFO EPI
 RIGHT JOIN LIS_REQUESTION_RECEIVE_TROUBLE RR
    ON EPI.PATIENT_ID = RR.BARCODE
 WHERE EPI.PERSON_INFO_ID IS NOT NULL